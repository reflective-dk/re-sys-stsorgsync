---
id: 21eb3880-959c-4a2c-806f-fe72170aa179
registrations:
  - validity:
      - input:
          class: { id: efefe41d-805b-478f-8e4d-841085cb7dfa, name: Type Map }
          name: Unit -> STSOrgSync Unit (Administrativ)
          sourceType: { id: 5cad9972-6560-4136-a9d5-40c2d109be9b, name: Unit }
          targetType: { id: 5c71d76c-9c97-4365-ade6-4bb0add4546f, name: STSOrgSync Unit }
          idSeed: id
          condition:
            type: mustNotProduceValue
            mapping: excludeFromStsOrg
          warmUps:
            units: { relatesTo: { class: 5cad9972-6560-4136-a9d5-40c2d109be9b } }
          mappings:
            excludeFromStsOrg:
              sourceAttribute:
                - type: findAncestor
                  selfIfNotFound: false
                  parentRelation: parents.administrativ
                  condition:
                    type: mustBeTruthy
                    attribute: aggregateSubTree.stsOrg
                - type: path
                  path: [ name ]
              targetAttribute: excludeFromStsOrg
            hierarchicalRoots:
              sourceAttribute: hierarchicalRoots.administrativ
              targetAttribute: hierarchicalRoots.administrativ
            uuid:
              sourceAttribute: id
              targetAttribute: Uuid
            name:
              sourceAttribute: name
              targetAttribute: name
            parentOrgUnitUuid:
              sourceAttribute: parents.administrativ.id
              targetAttribute: ParentOrgUnitUuid
            parent:
              sourceAttribute: parents.administrativ.id
              targetAttribute: parents.stsorgsync
              transform:
                type: relation
                target: { id: 5c71d76c-9c97-4365-ade6-4bb0add4546f, name: STSOrgSync Unit }
            tasks:
              sourceAttribute: id
              targetAttribute: Tasks
              transform:
                - type: lookup
                  lookupRelation: entity
                  # only get tasks for profile for KLE Emneplan Ansvarsomr√•de
                  query:
                    relatesTo:
                      class: 8b0390d1-74b9-48a2-a4cf-406e934ea120
                      profile: 624bb3a3-77a4-4a7c-8bab-c5981ad34a17
                  composable: true
                  filterActive: true
                - type: descend
                  attribute: 'auxiliary.364ae336-9dbe-43c3-95af-aec23c54d358'
            post:
              sourceAttribute:
                type: path
                path: [ locations.$, address, streetAddress ]
              targetAttribute: Post
            type:
              sourceAttribute: name
              targetAttribute: Type
              transform:
                type: constant
                value: DEPARTMENT
            activeFrom:
              sourceAttribute: activeFrom
              targetAttribute: activeFrom
            activeTo:
              sourceAttribute: activeTo
              targetAttribute: activeTo
        from: 2018-11-01T00:00:00.000Z
...
